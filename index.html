<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sean & Naomi Love Story</title>
  <style>
    /* Basic styles */
    #content {
      transition: opacity 0.5s ease;
      opacity: 1;
    }
    .fade-out {
      opacity: 0;
    }
    /* Modal styles */
    #modal {
      display: none;
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    #modal-message {
      background: white;
      padding: 1em 2em;
      border-radius: 8px;
      max-width: 80vw;
      text-align: center;
    }
    /* Gallery & lightbox */
    .gallery img {
      cursor: pointer;
      max-width: 100px;
      margin: 0 5px;
      border-radius: 4px;
      border: 2px solid transparent;
    }
    .gallery img:focus {
      outline: 2px solid blue;
    }
    /* Chat widget */
    #chat-widget {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 300px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      z-index: 9999;
    }
    #chat-header {
      background: #007bff;
      color: white;
      padding: 8px 12px;
      cursor: pointer;
      user-select: none;
    }
    #chat-messages {
      flex-grow: 1;
      overflow-y: auto;
      background: #f9f9f9;
      padding: 10px;
      height: 200px;
      font-size: 0.9rem;
    }
    .chat-message {
      margin: 6px 0;
      padding: 6px 10px;
      border-radius: 10px;
      max-width: 80%;
      word-wrap: break-word;
    }
    .chat-message.user {
      background: #dcf8c6;
      align-self: flex-end;
    }
    .chat-message.bot {
      background: #e5e5ea;
      align-self: flex-start;
    }
    #chat-input {
      display: flex;
      padding: 8px 12px;
      border-top: 1px solid #ccc;
    }
    #chat-textarea {
      flex-grow: 1;
      resize: none;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 6px 8px;
      font-size: 1rem;
      font-family: inherit;
    }
    #chat-send-btn {
      margin-left: 8px;
      padding: 6px 12px;
      font-weight: bold;
      cursor: pointer;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<!-- Main content container -->
<div id="content"></div>

<!-- Modal -->
<div id="modal" role="dialog" aria-modal="true" aria-labelledby="modal-message" tabindex="-1">
  <div id="modal-message"></div>
</div>

<!-- Chat widget -->
<div id="chat-widget" aria-label="Chatbot" aria-live="polite">
  <div id="chat-header" role="button" tabindex="0" aria-expanded="true">SLN Bot 💬</div>
  <div id="chat-messages" aria-live="polite" aria-relevant="additions"></div>
  <div id="chat-input">
    <textarea id="chat-textarea" rows="2" aria-label="Type your message"></textarea>
    <button id="chat-send-btn" aria-label="Send message">Send</button>
  </div>
</div>

<script>
  // Pages content (example placeholders)
  const pages = {
    home: `<section id="home"><h1>Welcome to Sean & Naomi's Story</h1><p>Home page content here...</p></section>`,
    story: `<section id="story"><h1>Their Story</h1><p>This is how they met...</p></section>`,
    gallery: `<section id="gallery" class="gallery" tabindex="0">
                <h1>Gallery</h1>
                <img src="https://placekitten.com/200/200" alt="Cute kitten 1" tabindex="0">
                <img src="https://placekitten.com/201/200" alt="Cute kitten 2" tabindex="0">
                <img src="https://placekitten.com/202/200" alt="Cute kitten 3" tabindex="0">
              </section>`,
    contact: `<section id="contact"><h1>Contact Us</h1>
                <form id="contact-form" novalidate>
                  <label for="name">Name:</label><br />
                  <input id="name" name="name" type="text" required minlength="2"><br />
                  <label for="email">Email:</label><br />
                  <input id="email" name="email" type="email" required><br />
                  <label for="message">Message:</label><br />
                  <textarea id="message" name="message" rows="4" required minlength="5"></textarea><br />
                  <button type="submit">Send Message</button>
                </form>
              </section>`,
    timeline: `<section id="timeline"><h1>Timeline</h1><p>Important dates and events...</p></section>`
  };

  // Elements
  const content = document.getElementById('content');
  const modal = document.getElementById('modal');
  const modalMessage = document.getElementById('modal-message');

  let currentPage = '';

  // Navigation with fade animation and setup hooks
  function navigate(page) {
    if (page === currentPage || !(page in pages)) return;

    content.classList.add('fade-out');

    setTimeout(() => {
      content.innerHTML = pages[page];
      currentPage = page;
      content.classList.remove('fade-out');

      if (page === 'contact') setupContactForm();
      if (page === 'gallery') setupGalleryLightbox();
    }, 500);
  }

  // Modal show/hide
  function showModal(message) {
    modalMessage.textContent = message;
    modal.style.display = 'flex';
    modal.focus();
  }

  function closeModal() {
    modal.style.display = 'none';
  }

  // Close modal on ESC
  window.addEventListener('keydown', e => {
    if (e.key === 'Escape' && modal.style.display === 'flex') {
      closeModal();
    }
  });

  // Contact form setup
  function setupContactForm() {
    const form = document.getElementById('contact-form');
    if (!form) return;

    form.addEventListener('submit', async e => {
      e.preventDefault();

      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending...';

      const formData = new FormData(form);

      try {
        const response = await fetch('https://formsubmit.co/ajax/j12345@kcis.com.tw', {
          method: 'POST',
          body: formData,
          headers: { 'Accept': 'application/json' }
        });

        const data = await response.json();
        if (data.success) {
          form.reset();
          showModal('Message sent! 💖 Thank you for contacting us.');
        } else {
          showModal('Something went wrong. Please try again.');
        }
      } catch (error) {
        showModal('There was an error sending your message. Please try again later.');
        console.error(error);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Message';
      }
    }, { once: true }); // Attach once to prevent multiple listeners
  }

  // Gallery lightbox setup
  let lightbox = null;

  function setupGalleryLightbox() {
    const imgs = document.querySelectorAll('.gallery img');
    imgs.forEach(img => {
      img.addEventListener('click', () => openLightbox(img.src, img.alt));
      img.addEventListener('keypress', e => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openLightbox(img.src, img.alt);
        }
      });
    });
  }

  function openLightbox(src, alt) {
    if (!lightbox) {
      lightbox = document.createElement('div');
      Object.assign(lightbox.style, {
        position: 'fixed',
        top: '0', left: '0',
        width: '100vw',
        height: '100vh',
        backgroundColor: 'rgba(0,0,0,0.8)',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        zIndex: '100000',
        cursor: 'pointer',
      });
      lightbox.tabIndex = 0;
      lightbox.setAttribute('role', 'dialog');
      lightbox.setAttribute('aria-modal', 'true');
      lightbox.setAttribute('aria-label', 'Image preview');

      const img = document.createElement('img');
      Object.assign(img.style, {
        maxWidth: '90vw',
        maxHeight: '90vh',
        borderRadius: '8px',
        boxShadow: '0 0 20px rgba(255,255,255,0.5)',
      });
      img.alt = alt || '';
      lightbox.appendChild(img);

      lightbox.addEventListener('click', closeLightbox);
      lightbox.addEventListener('keydown', e => {
        if (e.key === 'Escape') closeLightbox();
      });

      document.body.appendChild(lightbox);
    }
    lightbox.firstChild.src = src;
    lightbox.firstChild.alt = alt || '';
    lightbox.style.display = 'flex';
    lightbox.focus();
  }

  function closeLightbox() {
    if (lightbox) {
      lightbox.style.display = 'none';
    }
  }

  // Chat widget elements
  const chatWidget = document.getElementById('chat-widget');
  const chatHeader = document.getElementById('chat-header');
  const chatMessages = document.getElementById('chat-messages');
  const chatTextarea = document.getElementById('chat-textarea');
  const chatSendBtn = document.getElementById('chat-send-btn');
  const chatInputContainer = document.getElementById('chat-input');

  let chatOpen = true;

  // Toggle chat on header click or enter/space
  function toggleChat() {
    chatOpen = !chatOpen;
    chatMessages.style.display = chatOpen ? 'block' : 'none';
    chatInputContainer.style.display = chatOpen ? 'flex' : 'none';
    chatHeader.setAttribute('aria-expanded', chatOpen.toString());
  }

  chatHeader.addEventListener('click', toggleChat);
  chatHeader.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      toggleChat();
    }
  });

  // Append message helper
  function appendChatMessage(text, sender = 'bot') {
    const div = document.createElement('div');
    div.textContent = text;
    div.classList.add('chat-message', sender);
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  // Send chat message handler
  function sendChatMessage() {
    const message = chatTextarea.value.trim();
    if (!message) return;

    appendChatMessage(message, 'user');
    chatTextarea.value = '';

    // Bot replies with basic keyword logic + navigates pages using navigate()
    setTimeout(() => {
      const msg = message.toLowerCase();
      let reply = "I'm just a simple bot. Ask me anything about Sean & Naomi 💞";

      if (msg.includes("hello") || msg.includes("hi")) {
        reply = "Hi there! ❤️ How can I help you?";
      } else if (msg.includes("gallery") || msg.includes("photos") || msg.includes("pictures")) {
        reply = "Sure! Here’s the gallery 📸";
        navigate('gallery');
      } else if (msg.includes("story") || msg.includes("how they met") || msg.includes("begin")) {
        reply = "Let me take you to their beautiful story 🌸";
        navigate('story');
      } else if (msg.includes("contact") || msg.includes("message") || msg.includes("email")) {
        reply = "Want to leave us a message? Here's the contact page ✉️";
        navigate('contact');
      } else if (msg.includes("timeline") || msg.includes("events") || msg.includes("dates")) {
        reply = "Here's the timeline of Sean & Naomi's love story 🕒";
        navigate('timeline');
      } else if (msg.includes("help")) {
        reply = "Try asking me about 'gallery', 'story', 'contact', or 'timeline'.";
      }

      appendChatMessage(reply, 'bot');
    }, 800);
  }

  chatSendBtn.addEventListener('click', sendChatMessage);
  chatTextarea.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendChatMessage();
    }
  });

  // Initialize page
  navigate('home');

  // Accessibility: trap modal focus
  modal.addEventListener('keydown', e => {
    if (e.key === 'Tab') {
      e.preventDefault(); // Simplified focus trap, only modal-message in modal
      modalMessage.focus();
    }
  });

</script>

</body>
</html>
