<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sean & Naomi Love Story</title>
  <style>
    /* Basic styles */
    #content {
      transition: opacity 0.5s ease;
      opacity: 1;
    }
    .fade-out {
      opacity: 0;
    }
    /* Modal styles */
    #modal {
      display: none;
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    #modal-message {
      background: white;
      padding: 1em 2em;
      border-radius: 8px;
      max-width: 80vw;
      text-align: center;
    }
    /* Gallery & lightbox */
    .gallery img {
      cursor: pointer;
      max-width: 100px;
      margin: 0 5px;
      border-radius: 4px;
      border: 2px solid transparent;
    }
    .gallery img:focus {
      outline: 2px solid blue;
    }
    /* Chat widget */
    #chat-widget {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 300px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      z-index: 9999;
    }
    #chat-header {
      background: #007bff;
      color: white;
      padding: 8px 12px;
      cursor: pointer;
      user-select: none;
    }
    #chat-messages {
      flex-grow: 1;
      overflow-y: auto;
      background: #f9f9f9;
      padding: 10px;
      height: 200px;
      font-size: 0.9rem;
    }
    .chat-message {
      margin: 6px 0;
      padding: 6px 10px;
      border-radius: 10px;
      max-width: 80%;
      word-wrap: break-word;
    }
    .chat-message.user {
      background: #dcf8c6;
      align-self: flex-end;
    }
    .chat-message.bot {
      background: #e5e5ea;
      align-self: flex-start;
    }
    #chat-input {
      display: flex;
      padding: 8px 12px;
      border-top: 1px solid #ccc;
    }
    #chat-textarea {
      flex-grow: 1;
      resize: none;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 6px 8px;
      font-size: 1rem;
      font-family: inherit;
    }
    #chat-send-btn {
      margin-left: 8px;
      padding: 6px 12px;
      font-weight: bold;
      cursor: pointer;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<!-- Main content container -->
<div id="content"></div>

<!-- Modal -->
<div id="modal" role="dialog" aria-modal="true" aria-labelledby="modal-message" tabindex="-1">
  <div id="modal-message"></div>
</div>

<!-- Chat widget -->
<div id="chat-widget" aria-label="Chatbot" aria-live="polite">
  <div id="chat-header" role="button" tabindex="0" aria-expanded="true">SLN Bot 💬</div>
  <div id="chat-messages" aria-live="polite" aria-relevant="additions"></div>
  <div id="chat-input">
    <textarea id="chat-textarea" rows="2" aria-label="Type your message"></textarea>
    <button id="chat-send-btn" aria-label="Send message">Send</button>
  </div>
</div>

<script>
  // Pages content (example placeholders)
    const pages = {
      home: `
        <h2>Welcome to SLN</h2>
        <p>Boboler says hi</p>
      `,
      story: `
        <h2>How It All Began</h2>
        <p>bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah bismillah</p>
      `,
      gallery: `
        <h2>Moments Captured</h2>
        <div class="gallery" role="list">
          <img src="https://lh3.googleusercontent.com/a-/ALV-UjV7UYfjfZNY8MKU8r8i4pFGyhpfpKVAA3eVkWVEO_E0GIfLa7Sj=s128-p-k-rw-no" alt="Naomi's Teddy Bear" tabindex="0" role="listitem">
          <img src="file:///var/folders/c3/2pk06vgs2r50fdrjhmbyhtjr0000gn/T/TemporaryItems/NSIRD_screencaptureui_M9ngss/%E6%88%AA%E5%9C%96%202025-06-18%20%E4%B8%8A%E5%8D%889.57.15.png" alt="Walking together" tabindex="0" role="listitem">
          <img src="https://via.placeholder.com/300x200?text=Paris+Trip" alt="Paris Trip" tabindex="0" role="listitem">
          <img src="https://via.placeholder.com/300x200?text=Beach+Sunset" alt="Beach Sunset" tabindex="0" role="listitem">
        </div>
      `,
      timeline: `
        <h2>Timeline</h2>
        <p>2025/1/__ – Labubu met</p>
        <p>2025/2/__ – 告白</p>
        <p>2025/5/30 – 一起走被boboler+dean拍</p>
        <p>2025/6/3 – Naomi becomes the priest's wife in Bobolism</p>
        <p>2025/6/4 – Sean Liao becomes king</p>
        <p>2025/6/4 – Naomi becomes queen</p>
        <p>2025/6/15 – Sean 14th Birthday – 開放水域</p>
        <p>2025/9/17 – Naomi 15th Birthday</p>
        <p>2027/6/15 – Sean 16th Birthday – (Hint: chapter 28)</p>
        <p>2028/6/15 – Sean 17th Birthday – 訂婚</p>
        <p>2029/6/15 – Sean 18th Birthday – 結婚</p>
        <p>2029/6/16 – Naomi van den Heuvel → Naomi Liao</p>
        <p>2031/6/15 – Sean 20th Birthday – make babies</p>
        <p>2032/4/15 – Children born (___ Liao)</p>
        <p>2032/6/15 – Sean 21st Birthday</p>
        <p>2033/6/15 – Sean 22nd Birthday – graduate from college</p>
        <p>2034/6/15 – Sean 23rd Birthday – another make baby thing</p>
        <p>2035/6/15 – Sean 24th Birthday – another baby born (___ Liao)</p>
      `,
      contact: `
        <h2>Contact Us</h2>
        <form id="contact-form" novalidate>
          <label for="name">Your name</label>
          <input type="text" id="name" name="name" placeholder="Your name" required>
          <label for="email">Your email</label>
          <input type="email" id="email" name="email" placeholder="Your email" required>
          <label for="message">Your message</label>
          <textarea id="message" name="message" placeholder="Your message..." rows="6" required></textarea>
          <button type="submit">Send Message</button>
        </form>
      `
    };



  // Elements
  const content = document.getElementById('content');
  const modal = document.getElementById('modal');
  const modalMessage = document.getElementById('modal-message');

  let currentPage = '';

  // Navigation with fade animation and setup hooks
  function navigate(page) {
    if (page === currentPage || !(page in pages)) return;

    content.classList.add('fade-out');

    setTimeout(() => {
      content.innerHTML = pages[page];
      currentPage = page;
      content.classList.remove('fade-out');

      if (page === 'contact') setupContactForm();
      if (page === 'gallery') setupGalleryLightbox();
    }, 500);
  }

  // Modal show/hide
  function showModal(message) {
    modalMessage.textContent = message;
    modal.style.display = 'flex';
    modal.focus();
  }

  function closeModal() {
    modal.style.display = 'none';
  }

  // Close modal on ESC
  window.addEventListener('keydown', e => {
    if (e.key === 'Escape' && modal.style.display === 'flex') {
      closeModal();
    }
  });

  // Contact form setup
  function setupContactForm() {
    const form = document.getElementById('contact-form');
    if (!form) return;

    form.addEventListener('submit', async e => {
      e.preventDefault();

      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending...';

      const formData = new FormData(form);

      try {
        const response = await fetch('https://formsubmit.co/ajax/j12345@kcis.com.tw', {
          method: 'POST',
          body: formData,
          headers: { 'Accept': 'application/json' }
        });

        const data = await response.json();
        if (data.success) {
          form.reset();
          showModal('Message sent! 💖 Thank you for contacting us.');
        } else {
          showModal('Something went wrong. Please try again.');
        }
      } catch (error) {
        showModal('There was an error sending your message. Please try again later.');
        console.error(error);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Message';
      }
    }, { once: true }); // Attach once to prevent multiple listeners
  }

  // Gallery lightbox setup
  let lightbox = null;

  function setupGalleryLightbox() {
    const imgs = document.querySelectorAll('.gallery img');
    imgs.forEach(img => {
      img.addEventListener('click', () => openLightbox(img.src, img.alt));
      img.addEventListener('keypress', e => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openLightbox(img.src, img.alt);
        }
      });
    });
  }

  function openLightbox(src, alt) {
    if (!lightbox) {
      lightbox = document.createElement('div');
      Object.assign(lightbox.style, {
        position: 'fixed',
        top: '0', left: '0',
        width: '100vw',
        height: '100vh',
        backgroundColor: 'rgba(0,0,0,0.8)',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        zIndex: '100000',
        cursor: 'pointer',
      });
      lightbox.tabIndex = 0;
      lightbox.setAttribute('role', 'dialog');
      lightbox.setAttribute('aria-modal', 'true');
      lightbox.setAttribute('aria-label', 'Image preview');

      const img = document.createElement('img');
      Object.assign(img.style, {
        maxWidth: '90vw',
        maxHeight: '90vh',
        borderRadius: '8px',
        boxShadow: '0 0 20px rgba(255,255,255,0.5)',
      });
      img.alt = alt || '';
      lightbox.appendChild(img);

      lightbox.addEventListener('click', closeLightbox);
      lightbox.addEventListener('keydown', e => {
        if (e.key === 'Escape') closeLightbox();
      });

      document.body.appendChild(lightbox);
    }
    lightbox.firstChild.src = src;
    lightbox.firstChild.alt = alt || '';
    lightbox.style.display = 'flex';
    lightbox.focus();
  }

  function closeLightbox() {
    if (lightbox) {
      lightbox.style.display = 'none';
    }
  }

  // Chat widget elements
  const chatWidget = document.getElementById('chat-widget');
  const chatHeader = document.getElementById('chat-header');
  const chatMessages = document.getElementById('chat-messages');
  const chatTextarea = document.getElementById('chat-textarea');
  const chatSendBtn = document.getElementById('chat-send-btn');
  const chatInputContainer = document.getElementById('chat-input');

  let chatOpen = true;

  // Toggle chat on header click or enter/space
  function toggleChat() {
    chatOpen = !chatOpen;
    chatMessages.style.display = chatOpen ? 'block' : 'none';
    chatInputContainer.style.display = chatOpen ? 'flex' : 'none';
    chatHeader.setAttribute('aria-expanded', chatOpen.toString());
  }

  chatHeader.addEventListener('click', toggleChat);
  chatHeader.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      toggleChat();
    }
  });

  // Append message helper
  function appendChatMessage(text, sender = 'bot') {
    const div = document.createElement('div');
    div.textContent = text;
    div.classList.add('chat-message', sender);
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  // Send chat message handler
  function sendChatMessage() {
    const message = chatTextarea.value.trim();
    if (!message) return;

    appendChatMessage(message, 'user');
    chatTextarea.value = '';

    // Bot replies with basic keyword logic + navigates pages using navigate()
    setTimeout(() => {
      const msg = message.toLowerCase();
      let reply = "I'm just a simple bot. Ask me anything about Sean & Naomi 💞";

      if (msg.includes("hello") || msg.includes("hi")) {
        reply = "Hi there! ❤️ How can I help you?";
      } else if (msg.includes("gallery") || msg.includes("photos") || msg.includes("pictures")) {
        reply = "Sure! Here’s the gallery 📸";
        navigate('gallery');
      } else if (msg.includes("story") || msg.includes("how they met") || msg.includes("begin")) {
        reply = "Let me take you to their beautiful story 🌸";
        navigate('story');
      } else if (msg.includes("contact") || msg.includes("message") || msg.includes("email")) {
        reply = "Want to leave us a message? Here's the contact page ✉️";
        navigate('contact');
      } else if (msg.includes("timeline") || msg.includes("events") || msg.includes("dates")) {
        reply = "Here's the timeline of Sean & Naomi's love story 🕒";
        navigate('timeline');
      } else if (msg.includes("help")) {
        reply = "Try asking me about 'gallery', 'story', 'contact', or 'timeline'.";
      }

      appendChatMessage(reply, 'bot');
    }, 800);
  }

  chatSendBtn.addEventListener('click', sendChatMessage);
  chatTextarea.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendChatMessage();
    }
  });

  // Initialize page
  navigate('home');

  // Accessibility: trap modal focus
  modal.addEventListener('keydown', e => {
    if (e.key === 'Tab') {
      e.preventDefault(); // Simplified focus trap, only modal-message in modal
      modalMessage.focus();
    }
  });

</script>

</body>
</html>
